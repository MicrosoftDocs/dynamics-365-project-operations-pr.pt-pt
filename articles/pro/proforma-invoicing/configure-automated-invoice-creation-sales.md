---
title: Configurar a criação automática de faturas
description: Esta tópico fornece informações sobre a configuração automática de faturas proforma.
author: rumant
manager: Annbe
ms.date: 04/05/2021
ms.topic: article
ms.service: project-operations
ms.reviewer: kfend
ms.author: rumant
ms.openlocfilehash: 359c5902e0b6a08ab7fc982095062e4d1816db6c
ms.sourcegitcommit: ca0fc078d1a12484eca193fe051b8442c0559db8
ms.translationtype: HT
ms.contentlocale: pt-PT
ms.lasthandoff: 04/07/2021
ms.locfileid: "5866831"
---
# <a name="set-up-automatic-invoice-creation"></a><span data-ttu-id="cd65e-103">Configurar criação automática de faturas</span><span class="sxs-lookup"><span data-stu-id="cd65e-103">Set up automatic invoice creation</span></span> 
 
<span data-ttu-id="cd65e-104">_**Aplica-se a:** Implementação leve - negociar à faturação pró-forma, Project Operations para cenários baseados em recursos/não armazenados_</span><span class="sxs-lookup"><span data-stu-id="cd65e-104">_**Applies To:** Lite deployment - deal to proforma invoicing, Project Operations for resource/non-stocked based scenarios_</span></span>

<span data-ttu-id="cd65e-105">Pode configurar a criação automática de faturas no Dynamics 365 Project Operations.</span><span class="sxs-lookup"><span data-stu-id="cd65e-105">You can configure automatic invoice creation in Dynamics 365 Project Operations.</span></span> <span data-ttu-id="cd65e-106">O sistema cria uma fatura pró-forma de rascunho com base na agenda de faturação de cada contrato de projeto e item de contrato.</span><span class="sxs-lookup"><span data-stu-id="cd65e-106">The system creates a draft proforma invoice based on the invoice schedule for each project contract and contract line.</span></span> <span data-ttu-id="cd65e-107">As agendas de faturação são configuradas ao nível do item de contrato.</span><span class="sxs-lookup"><span data-stu-id="cd65e-107">Invoice schedules are configured at the contract line level.</span></span> <span data-ttu-id="cd65e-108">Cada item de um contrato pode ter uma agenda de faturação distinta, ou a mesma agenda de faturação pode ser incluída em todos os itens do contrato.</span><span class="sxs-lookup"><span data-stu-id="cd65e-108">Each line on a contract can have a distinct invoice schedule, or the same invoice schedule can be included on every line of the contract.</span></span>

<span data-ttu-id="cd65e-109">Quando cria uma fatura, o sistema cria sempre, pelo menos, uma fatura por contrato de projeto.</span><span class="sxs-lookup"><span data-stu-id="cd65e-109">When you create an invoice, the system always creates at least one invoice per project contract.</span></span> <span data-ttu-id="cd65e-110">Em alguns casos, podem haver várias faturas criadas.</span><span class="sxs-lookup"><span data-stu-id="cd65e-110">In some cases, there may be multiple invoices created.</span></span> <span data-ttu-id="cd65e-111">Por exemplo, se o contrato tiver vários clientes, o mesmo número de faturas será criado como o número de clientes que têm transações faturadas nesse contrato de projeto.</span><span class="sxs-lookup"><span data-stu-id="cd65e-111">For example, if the contract has multiple customers, the same number of invoices will be created as the number of customers that have billable transactions to invoice on that project contract.</span></span>

## <a name="understand-how-transactions-are-included-on-an-invoice"></a><span data-ttu-id="cd65e-112">Entenda como as transações são incluídas numa fatura</span><span class="sxs-lookup"><span data-stu-id="cd65e-112">Understand how transactions are included on an invoice</span></span> 

<span data-ttu-id="cd65e-113">Por vezes, cada item de contrato baseado em projeto especifica uma agenda de faturação separada.</span><span class="sxs-lookup"><span data-stu-id="cd65e-113">Sometimes, each project-based contract line specifies a separate invoice schedule.</span></span> <span data-ttu-id="cd65e-114">Por exemplo, os serviços de implementação do contrato Adatum têm os seguintes itens contratuais:</span><span class="sxs-lookup"><span data-stu-id="cd65e-114">For example, implementation services for the Adatum contract have the following contract lines:</span></span>

- <span data-ttu-id="cd65e-115">Trabalho protótipo que é um preço fixo com dois marcos criados manualmente.</span><span class="sxs-lookup"><span data-stu-id="cd65e-115">Prototype work that is a fixed price with two manually created milestones.</span></span>
- <span data-ttu-id="cd65e-116">Trabalho de implementação que inclui Tempo e será faturado quinzenalmente às segundas-feiras.</span><span class="sxs-lookup"><span data-stu-id="cd65e-116">Implementation work that includes Time and will be billed bi-weekly on Mondays.</span></span>
- <span data-ttu-id="cd65e-117">Despesas incorridas que precisam de ser faturadas mensalmente na primeira segunda-feira de cada mês.</span><span class="sxs-lookup"><span data-stu-id="cd65e-117">Expenses incurred that need to be billed monthly on the first Monday of each month.</span></span>

<span data-ttu-id="cd65e-118">As agendas das faturas definidas em cada uma destes dois itens de linha parecem-se com a seguinte tabela:</span><span class="sxs-lookup"><span data-stu-id="cd65e-118">Invoice schedules defined on each of these two line items look like the following table:</span></span>

| <span data-ttu-id="cd65e-119">Item de contrato</span><span class="sxs-lookup"><span data-stu-id="cd65e-119">Contract line</span></span> | <span data-ttu-id="cd65e-120">Data de execução da fatura</span><span class="sxs-lookup"><span data-stu-id="cd65e-120">Invoice run date</span></span> | <span data-ttu-id="cd65e-121">Data limite da transação</span><span class="sxs-lookup"><span data-stu-id="cd65e-121">Transaction cut-off date</span></span> | <span data-ttu-id="cd65e-122">Data do marco</span><span class="sxs-lookup"><span data-stu-id="cd65e-122">Milestone date</span></span> | <span data-ttu-id="cd65e-123">Montante do marco</span><span class="sxs-lookup"><span data-stu-id="cd65e-123">Milestone amount</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="cd65e-124">Trabalho de protótipo</span><span class="sxs-lookup"><span data-stu-id="cd65e-124">Prototype work</span></span> | <span data-ttu-id="cd65e-125">5 de outubro, segunda-feira</span><span class="sxs-lookup"><span data-stu-id="cd65e-125">October 5, Monday</span></span> | - | <span data-ttu-id="cd65e-126">5 de outubro, segunda-feira</span><span class="sxs-lookup"><span data-stu-id="cd65e-126">October 5, Monday</span></span> | <span data-ttu-id="cd65e-127">5000 USD</span><span class="sxs-lookup"><span data-stu-id="cd65e-127">5000 USD</span></span> |
| - | <span data-ttu-id="cd65e-128">3 de novembro, terça-feira</span><span class="sxs-lookup"><span data-stu-id="cd65e-128">November 3, Tuesday</span></span> | - | <span data-ttu-id="cd65e-129">3 de novembro, terça-feira</span><span class="sxs-lookup"><span data-stu-id="cd65e-129">November 3, Tuesday</span></span> | <span data-ttu-id="cd65e-130">12,000 USD</span><span class="sxs-lookup"><span data-stu-id="cd65e-130">12,000 USD</span></span> |
| <span data-ttu-id="cd65e-131">Trabalho de implementação</span><span class="sxs-lookup"><span data-stu-id="cd65e-131">Implementation work</span></span> | <span data-ttu-id="cd65e-132">5 de outubro, segunda-feira</span><span class="sxs-lookup"><span data-stu-id="cd65e-132">October 5, Monday</span></span> | <span data-ttu-id="cd65e-133">4 de outubro, domingo</span><span class="sxs-lookup"><span data-stu-id="cd65e-133">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="cd65e-134">19 de outubro, segunda-feira</span><span class="sxs-lookup"><span data-stu-id="cd65e-134">October 19, Monday</span></span> | <span data-ttu-id="cd65e-135">18 de outubro, domingo</span><span class="sxs-lookup"><span data-stu-id="cd65e-135">October 18, Sunday</span></span> | - | - |
| - | <span data-ttu-id="cd65e-136">2 de novembro, segunda-feira</span><span class="sxs-lookup"><span data-stu-id="cd65e-136">November 2, Monday</span></span> | <span data-ttu-id="cd65e-137">1 de novembro, domingo</span><span class="sxs-lookup"><span data-stu-id="cd65e-137">November 1, Sunday</span></span> | - | - |
| - | <span data-ttu-id="cd65e-138">16 de novembro, segunda-feira</span><span class="sxs-lookup"><span data-stu-id="cd65e-138">November 16, Monday</span></span> | <span data-ttu-id="cd65e-139">15 de novembro, domingo</span><span class="sxs-lookup"><span data-stu-id="cd65e-139">November 15, Sunday</span></span> | - | - |
| <span data-ttu-id="cd65e-140">Despesas incorridas</span><span class="sxs-lookup"><span data-stu-id="cd65e-140">Expenses incurred</span></span> | <span data-ttu-id="cd65e-141">5 de outubro, segunda-feira</span><span class="sxs-lookup"><span data-stu-id="cd65e-141">October 5, Monday</span></span> | <span data-ttu-id="cd65e-142">4 de outubro, domingo</span><span class="sxs-lookup"><span data-stu-id="cd65e-142">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="cd65e-143">2 de novembro, segunda-feira</span><span class="sxs-lookup"><span data-stu-id="cd65e-143">November 2, Monday</span></span> | <span data-ttu-id="cd65e-144">1 de novembro, domingo</span><span class="sxs-lookup"><span data-stu-id="cd65e-144">November 1, Sunday</span></span> | - | - |

<span data-ttu-id="cd65e-145">Neste exemplo, quando a faturação automática é executada a:</span><span class="sxs-lookup"><span data-stu-id="cd65e-145">In this example when the automatic invoicing runs on:</span></span>

- <span data-ttu-id="cd65e-146">**4 de outubro ou qualquer data anterior**: não é gerada qualquer fatura para este contrato porque a tabela **Agenda de Faturação** para cada um destes itens de contrato não convoca 4 de outubro, domingo, como data de execução da fatura.</span><span class="sxs-lookup"><span data-stu-id="cd65e-146">**October 4 or any date before**: No invoice is generated for this contract because the **Invoice Schedule** table for each of these contract lines doesn't call out October 4, Sunday as an invoice run date.</span></span>
- <span data-ttu-id="cd65e-147">**5 de outubro, segunda-feira**: uma fatura é gerada para:</span><span class="sxs-lookup"><span data-stu-id="cd65e-147">**October 5 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="cd65e-148">Trabalho de protótipo que inclui o marco, se estiver marcado como **Pronto a Faturar**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-148">Prototype work that includes the milestone, if it is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="cd65e-149">Trabalho de implementação que inclui todas as transações de Tempo criadas antes da data de validade da transação de 4 de outubro, domingo, que está marcada como **Pronto a Faturar**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-149">Implementation work that includes all Time transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="cd65e-150">Despesas incorridas que incluem todas as transações de Despesas criadas antes da data de validade da transação de 4 de outubro, domingo, que está marcada como **Pronto a Faturar**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-150">Expense incurred that includes all Expense transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
  
- <span data-ttu-id="cd65e-151">**A 6 de outubro ou qualquer data anterior a 19 de outubro**: não é gerada qualquer fatura para este contrato porque a tabela **Agenda de Faturação** para cada um destes itens de contrato não convoca 6 de outubro ou qualquer data anterior a 19 de outubro, como data de execução da fatura.</span><span class="sxs-lookup"><span data-stu-id="cd65e-151">**On October 6 or any date before October 19**: No invoice is generated for this contract since the **Invoice Schedule** table for each of these contract lines does not call out October 6 or any date before October 19 as an invoice run date.</span></span>
- <span data-ttu-id="cd65e-152">**19 de outubro, segunda-feira**: é gerada uma fatura para trabalho de implementação que inclui todas as transações de Tempo criadas antes da data de validade da transação de 18 de outubro, domingo, que está marcada como **Pronto a Faturar**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-152">**October 19, Monday**: One invoice is generated for implementation work that includes all Time transactions created before the transaction cut-off date of October 18, Sunday, that is marked as **Ready to Invoice**.</span></span>
- <span data-ttu-id="cd65e-153">**2 de novembro, segunda-feira**: uma fatura é gerada para:</span><span class="sxs-lookup"><span data-stu-id="cd65e-153">**November 2 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="cd65e-154">Trabalho de implementação que inclui todas as transações de Tempo criadas antes da data de validade da transação de 1 de novembro, domingo, que está marcada como **Pronto a Faturar**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-154">Implementation work that includes all Time transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="cd65e-155">Despesas incorridas que incluem todas as transações de Despesas criadas antes da data de validade da transação de 1 de novembro, domingo, que está marcada como **Pronto a Faturar**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-155">Expense incurred that includes all Expense transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>

- <span data-ttu-id="cd65e-156">**3 de novembro, terça-feira**: é gerada uma fatura para o trabalho de protótipo que inclui o marco para 12.000 USD, se estiver marcado como **Pronto a Faturar**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-156">**November 3, Tuesday**: One invoice is generated for prototype work that includes the milestone for 12000 USD, if it is marked as **Ready to Invoice**.</span></span>

## <a name="configure-automatic-invoicing"></a><span data-ttu-id="cd65e-157">Configurar faturação automática</span><span class="sxs-lookup"><span data-stu-id="cd65e-157">Configure automatic invoicing</span></span>

<span data-ttu-id="cd65e-158">Conclua os seguintes passos para configurar a execução de fatura automatizada.</span><span class="sxs-lookup"><span data-stu-id="cd65e-158">Complete the following steps to configure an automated invoice run.</span></span>

1. <span data-ttu-id="cd65e-159">Em **Project Operations**, aceda a **Definições** > **Configuração de Fatura Recorrente**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-159">In **Project Operations**, go to **Settings** > **Recurring Invoice Setup**.</span></span>
2. <span data-ttu-id="cd65e-160">Crie uma tarefa de lote e atribua-lhe o nome **Criar faturas no Project Operations**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-160">Create a batch job, and name it **rPoject Operations Create Invoices**.</span></span> <span data-ttu-id="cd65e-161">O nome da tarefa de lote tem de incluir as palavras "criar faturas".</span><span class="sxs-lookup"><span data-stu-id="cd65e-161">The name of the batch job must include the words, "create invoices".</span></span>
3. <span data-ttu-id="cd65e-162">No campo **Tipo de Tarefa**, selecione **Nenhum**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-162">In the **Job Type** field, select **None**.</span></span> <span data-ttu-id="cd65e-163">Por predefinição, os campos **Frequência Diária** e **Está Ativo** estão definidas como **Sim**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-163">By default, the **Frequency Daily** and **Is Active** fields are set to **Yes**.</span></span>
4. <span data-ttu-id="cd65e-164">Selecione **Executar Fluxo de Trabalho**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-164">Select **Run Workflow**.</span></span> <span data-ttu-id="cd65e-165">Na caixa de diálogo **Pesquisar Registo**, verá três fluxos de trabalho:</span><span class="sxs-lookup"><span data-stu-id="cd65e-165">In the **Look Up Record** dialog box, you will see three workflows:</span></span>

- <span data-ttu-id="cd65e-166">ProcessRunCaller</span><span class="sxs-lookup"><span data-stu-id="cd65e-166">ProcessRunCaller</span></span>
- <span data-ttu-id="cd65e-167">ProcessRunner</span><span class="sxs-lookup"><span data-stu-id="cd65e-167">ProcessRunner</span></span>
- <span data-ttu-id="cd65e-168">UpdateRoleUtilization</span><span class="sxs-lookup"><span data-stu-id="cd65e-168">UpdateRoleUtilization</span></span>

5. <span data-ttu-id="cd65e-169">Selecione **ProcessRunCaller** e, em seguida, selecione **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-169">Select **ProcessRunCaller**, and then select **Add**.</span></span>
6. <span data-ttu-id="cd65e-170">Na caixa de diálogo seguinte, selecione **OK**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-170">In the next dialog box, select **OK**.</span></span> <span data-ttu-id="cd65e-171">Um fluxo de trabalho de **Suspensão** é seguido por um fluxo de trabalho do **Processo**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-171">A **Sleep** workflow is followed by a **Process** workflow.</span></span> 

> [!NOTE]
> <span data-ttu-id="cd65e-172">Também pode selecionar **ProcessRunner** no passo 5.</span><span class="sxs-lookup"><span data-stu-id="cd65e-172">You can also select **ProcessRunner** in step 5.</span></span> <span data-ttu-id="cd65e-173">Em seguida, quando selecionar **OK**, um fluxo de trabalho do **Processo** é seguido por um fluxo de trabalho de **Suspensão**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-173">Then, when you select **OK**, a **Process** workflow is followed by a **Sleep** workflow.</span></span>

<span data-ttu-id="cd65e-174">Os fluxos de trabalho **ProcessRunCaller** e **ProcessRunner** criam faturas.</span><span class="sxs-lookup"><span data-stu-id="cd65e-174">The **ProcessRunCaller** and **ProcessRunner** workflows create invoices.</span></span> <span data-ttu-id="cd65e-175">O **ProcessRunCaller** chama o **ProcessRunner**.</span><span class="sxs-lookup"><span data-stu-id="cd65e-175">**ProcessRunCaller** calls **ProcessRunner**.</span></span> <span data-ttu-id="cd65e-176">**ProcessRunner** é o fluxo de trabalho que, na realidade, cria as faturas.</span><span class="sxs-lookup"><span data-stu-id="cd65e-176">**ProcessRunner** is the workflow that actually creates the invoices.</span></span> <span data-ttu-id="cd65e-177">O fluxo de trabalha passa por todos os itens de contrato para os quais é necessário criar faturas e cria faturas para essas linhas.</span><span class="sxs-lookup"><span data-stu-id="cd65e-177">The workflow goes through all the contract lines that invoices must be created for, and creates invoices for those lines.</span></span> <span data-ttu-id="cd65e-178">Para determinar os itens de contrato para os quais devem ser criadas faturas, a tarefa examina as datas de execução da fatura para os itens de contrato.</span><span class="sxs-lookup"><span data-stu-id="cd65e-178">To determine the contract lines that invoices must be created for, the job looks at invoice run dates for the contract lines.</span></span> <span data-ttu-id="cd65e-179">Se os itens de contrato que pertencem a um contrato tiverem a mesma data de execução da fatura, as transações são combinadas numa fatura que tem duas linhas de fatura.</span><span class="sxs-lookup"><span data-stu-id="cd65e-179">If contract lines that belong to one contract have the same invoice run date, the transactions are combined into one invoice that has two invoice lines.</span></span> <span data-ttu-id="cd65e-180">Se não houver transações para as quais criar faturas, a tarefa ignora a criação de uma fatura.</span><span class="sxs-lookup"><span data-stu-id="cd65e-180">If there are no transactions to create invoices for, the job skips creating an invoice.</span></span>

<span data-ttu-id="cd65e-181">Depois de **ProcessRunner** ter terminado a execução, chama o **ProcessRunCaller**, fornece a hora de fim e é fechado.</span><span class="sxs-lookup"><span data-stu-id="cd65e-181">After **ProcessRunner** has finished running, it calls **ProcessRunCaller**, provides the end time, and is closed.</span></span> <span data-ttu-id="cd65e-182">**ProcessRunCaller** em seguida, inicia um temporizador que funciona durante 24 horas a partir da hora de fim especificada.</span><span class="sxs-lookup"><span data-stu-id="cd65e-182">**ProcessRunCaller** then starts a timer that runs for 24-hours from the specified end time.</span></span> <span data-ttu-id="cd65e-183">No final do temporizador, o **ProcessRunCaller** é fechado.</span><span class="sxs-lookup"><span data-stu-id="cd65e-183">At the end of the timer, **ProcessRunCaller** is closed.</span></span>

<span data-ttu-id="cd65e-184">A tarefa de processamento em lote para criar faturas é uma tarefa recorrente.</span><span class="sxs-lookup"><span data-stu-id="cd65e-184">The batch process job for creating invoices is a recurrent job.</span></span> <span data-ttu-id="cd65e-185">Se este processamento em lote for executado muitas vezes, são criadas várias instâncias da tarefa e causam erros.</span><span class="sxs-lookup"><span data-stu-id="cd65e-185">If this batch process is run many times, multiple instances of the job are created and causes errors.</span></span> <span data-ttu-id="cd65e-186">Consequentemente, deverá iniciar o processamento em lote apenas uma vez e, em seguida, reiniciar se parar de ser executado.</span><span class="sxs-lookup"><span data-stu-id="cd65e-186">Therefore, you should start the batch process only one time, and then restart only if it stops running.</span></span>

> [!NOTE]
> <span data-ttu-id="cd65e-187">A faturação do lote no Project Operations só funciona para itens de contrato do projeto que são configurados por horários da fatura.</span><span class="sxs-lookup"><span data-stu-id="cd65e-187">Batch invoicing in Project Operations only runs for project contract lines that are configured by invoice schedules.</span></span> <span data-ttu-id="cd65e-188">Uma linha de contrato com um método de faturação de preço fixo tem de ter marcos configurados.</span><span class="sxs-lookup"><span data-stu-id="cd65e-188">A contract line with a fixed price billing method must have milestones configured.</span></span> <span data-ttu-id="cd65e-189">Uma linha de contrato de projeto com um método de faturação de tempo e material necessitará de uma configuração de agenda de faturamento baseado em datas.</span><span class="sxs-lookup"><span data-stu-id="cd65e-189">A project contract line with a time and material billing method will need a date-based invoice schedule set up.</span></span>


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
